
stages:
  - lint
  - test

.bases:
  before_script:
    - php -v
    - composer --version
    - composer install
  cache:
    key: "$CI_COMMIT_REF_SLUG--$PHPENV_VERSION"
    paths:
      - vendor/
  tags:
    - php

.atoum:
  extends: .bases
  stage: test
  script: ./vendor/bin/atoum
  coverage: '/Code coverage value: \d+\.\d+%/'
  artifacts:
    reports:
      junit: reports/atoum-$PHPENV_VERSION.xunit.xml

.lint:
  extends: .bases
  stage: lint
  script:
    - mkdir -p reports
    - ./vendor/bin/phpcs --report=junit --report-file=reports/phpcs-$PHPENV_VERSION.junit.xml
  artifacts:
    reports:
      junit: reports/phpcs-$PHPENV_VERSION.junit.xml


atoum:PHP7.1:
  variables:
    PHPENV_VERSION: '7.1.26'
  extends: .atoum

atoum:PHP7.2:
  variables:
    PHPENV_VERSION: '7.2.14'
  extends: .atoum

atoum:PHP7.3:
  variables:
    PHPENV_VERSION: '7.3.1'
  extends: .atoum

atoum:PHP:nightly:
  variables:
    PHPENV_VERSION: master
  extends: .atoum
  allow_failure: true


lint:PHP7.1:
  variables:
    PHPENV_VERSION: '7.1.26'
  extends: .lint

lint:PHP7.2:
  variables:
    PHPENV_VERSION: '7.2.14'
  extends: .lint

lint:PHP7.3:
  variables:
    PHPENV_VERSION: '7.3.1'
  extends: .lint

lint:PHP:nightly:
  variables:
    PHPENV_VERSION: master
  extends: .lint
  allow_failure: true
