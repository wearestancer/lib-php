
stages:
  - lint
  - test
  - coverage
  - build
  - publish
  - notification
  - manual

variables:
  ATOUM_COVERAGE_FILENAME: "reports/${PHP_VERSION}-coverage.xml"
  ATOUM_XUNIT_FILENAME: "reports/${PHP_VERSION}-xunit.xml"
  BUILD_FILENAME: "lib-php-${CI_COMMIT_TAG}.tar.gz"
  PHPCS_FILENAME: "reports/${PHP_VERSION}-phpcs.json"
  PHPSTAN_FILENAME: "reports/${PHP_VERSION}-stan.json"


notification:mattermost:
  variables:
    MATTERMOST_FILE: "${CI_PROJECT_DIR}/lib-php-${CI_COMMIT_TAG}.tar.gz"
    POST_ICON: https://www.php.net/images/logos/new-php-logo.png

  needs:
    - job: build
      artifacts: true


include:
  - project: 'stancer/ci-template'
    file: '/php.yml'
  - project: 'stancer/ci-template'
    file: '/registry/composer.yml'
  - project: 'stancer/ci-template'
    file: '/notifications/mattermost/library.yml'


Hand job:
  extends:
    - atoum

  stage: manual

  rules:
    - if: '$CI_COMMIT_BRANCH == "develop"'
      when: manual
